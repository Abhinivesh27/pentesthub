import 'dart:developer';

import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:http/http.dart' as http;
import 'package:pentesthub/model/responsemodel.dart';

class HubService extends ChangeNotifier {
  String _fileName = "";
  Uint8List _fileBytesS = Uint8List(2);

  String get fileName => _fileName;
  Uint8List get fileBytesS => _fileBytesS;

  AndroidResponse _response = AndroidResponse(
    activities: [],
    packageName: "",
    permissions: [],
    versionName: "",
    bugs: [''],
    name: "",
    tech: [''],
  );
  AndroidResponse get response => _response;

  void getAndroidResponse() async {
    final url = Uri.parse('https://abhi27.pythonanywhere.com/analyze_apk');

    // Replace the path with the actual path to your APK file
    final fileBytes = fileBytesS;

    var apiResponse = await http.post(url, body: fileBytes);

    AndroidResponse buffer = AndroidResponse.fromJson(apiResponse.body);

    _response = buffer;
    // if (response.statusCode == 200) {
    //   log("Everythng ok");
    //   //print(response.body.toString());
    // } else {
    //   print('Request failed with status: ${response.statusCode}.');
    // }
    print(apiResponse.body.toString());
    notifyListeners();
  }

  void updateNameBytes(String name, Uint8List list) {
    _fileName = name;
    _fileBytesS = list;
    notifyListeners();
  }
}
