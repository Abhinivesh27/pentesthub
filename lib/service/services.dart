import 'dart:convert';
import 'dart:developer';

import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:http/http.dart' as http;
import 'package:pentesthub/model/responsemodel.dart';

class HubService extends ChangeNotifier {
  AndroidResponse _response = AndroidResponse(
    activities: [],
    packageName: "",
    permissions: [],
    versionName: "",
    bugs: [''],
    tech: [''],
    services: [],
  );

  AndroidResponse get response => _response;

  void getAndroidResponse(String apkurl) async {
    final url = Uri.parse('http://localhost:5000?apk=${apkurl}');
    log("Called call function");
    // Replace the path with the actual path to your APK file
    Map<String, String> headers = {
      'Content-Type': 'application/json',
    };
    var msg = jsonEncode(<String, String>{
      "apk":
          "https://firebasestorage.googleapis.com/v0/b/coin-play-cc27e.appspot.com/o/app.apk?alt=media&token=7d8c9961-5228-477d-916a-5893d9fc4661"
    });
    try {
      await http.post(
        url,
        headers: <String, String>{
          'Content-Type': 'application/json; charset=UTF-8',
        },
      );
    } catch (e) {
      log("Logged 2");
      log(e.toString());
    }
    Future.delayed(Duration(seconds: 20));
    try {
      log("Log 3");
      var apiResponse = await http.get(
        Uri.parse("http://localhost:5000/apk"),
      );
      print(apiResponse.body.toString());
      AndroidResponse buffer = AndroidResponse.fromJson(apiResponse.body);
      _response = buffer;
    } catch (e) {
      log(e.toString() + " Error 2");
    }
    log(_response.packageName + " name not come");
    // if (response.statusCode == 200) {
    //   log("Everythng ok");
    //   //print(response.body.toString());
    // } else {
    //   print('Request failed with status: ${response.statusCode}.');
    // }
    //print(apiResponse.body.toString());
    notifyListeners();
  }
}
